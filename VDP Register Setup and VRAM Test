; TMS9918A
.org $C000

VDP_VRAM    =       $B000 
VDP_REG     =       $B001 

VDP_WRITE_VRAM_BIT = $40
VDP_REGISTER_BITS = $80

VDP_NAME_TABLE_BASE = $0000
VDP_PATTERN_TABLE_BASE = $0800

; zero page addresses
VDP_PATTERN_INIT = $30
VDP_PATTERN_INIT_HI = $31

start:
jsr vdp_reg_reset
lda #$ff
sta $8003
jsr write
jsr read
jmp end

end:
jmp end



write:
lda #$00
sta VDP_REG
lda #$40
sta VDP_REG
lda #$aa
sta VDP_VRAM
rts

read:
lda #$00
sta VDP_REG
lda #$00
sta VDP_REG
lda VDP_VRAM
sta $8001
rts



vdp_reg_reset:
  pha
  phx

  ldx #0
vdp_reg_reset_loop:
  ; write value
  lda vdp_register_inits,x
  sta VDP_REG
  ; write reg #
  txa
  ora #VDP_REGISTER_BITS
  sta VDP_REG
  inx
  cpx #(vdp_end_register_inits - vdp_register_inits)
  bne vdp_reg_reset_loop
  plx
  pla
  rts
  
  vdp_register_inits:
vdp_register_0: .byte %00000000 ; 0  0  0  0  0  0  M3 EXTVDP
vdp_register_1: .byte %10010000 ;16k Bl IE M1 M2 0 Siz MAG
vdp_register_2: .byte $00       ; Name table base / $400. $00 = $0000
vdp_register_3: .byte $00       ; Color table base (currently unused)
vdp_register_4: .byte $01       ; Pattern table base / $800. $01 = $0800
vdp_register_5: .byte $00       ; Sprite attribute table base (currently unused)
vdp_register_6: .byte $00       ; Sprite pattern generator (currently unused)
vdp_register_7: .byte $F5       ; FG/BG. F=>White Text, 5=>Light Blue Background
vdp_end_register_inits:
